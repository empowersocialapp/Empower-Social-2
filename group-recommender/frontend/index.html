<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Recommender - Test Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #FFF5EB 0%, #FFE8D6 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FF8C42 0%, #FFA566 100%);
            border-radius: 8px;
        }

        h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 32px;
            color: #FF8C42;
            font-weight: 700;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            background: white;
            border: 2px solid #FF8C42;
            border-radius: 8px;
            color: #FF8C42;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'DM Sans', sans-serif;
        }

        .tab-button:hover {
            background: #FF8C42;
            color: white;
        }

        .tab-button.active {
            background: #FF8C42;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'DM Sans', sans-serif;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #FF8C42;
        }

        .button {
            background: linear-gradient(135deg, #FF8C42 0%, #FFA566 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            font-family: 'DM Sans', sans-serif;
        }

        .button:hover {
            transform: translateY(-2px);
        }

        .button:active {
            transform: translateY(0);
        }

        .results {
            margin-top: 30px;
        }

        .group-card {
            background: #FFF9F0;
            border-left: 4px solid #FF8C42;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .group-card h3 {
            color: #FF8C42;
            margin-bottom: 10px;
            font-family: 'Montserrat', sans-serif;
        }

        .group-card p {
            color: #666;
            margin-bottom: 8px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: #FFE8D6;
            color: #FF8C42;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
            margin-top: 8px;
        }

        .score {
            display: inline-block;
            padding: 6px 14px;
            background: #FF8C42;
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            color: #c62828;
        }

        .personality-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .personality-inputs > div {
            display: flex;
            flex-direction: column;
        }

        .personality-inputs label {
            font-size: 14px;
            margin-bottom: 5px;
        }

        h2 {
            font-family: 'Montserrat', sans-serif;
            color: #333;
            margin-bottom: 20px;
        }

        h3 {
            font-family: 'Montserrat', sans-serif;
            color: #333;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon"></div>
                <h1>Group Recommender</h1>
            </div>
            <p style="color: #666; margin-top: 10px;">Test Interface</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('groups')">Browse Groups</button>
            <button class="tab-button" onclick="showTab('recommend')">Get Recommendations</button>
            <button class="tab-button" onclick="showTab('personality')">Personality Quiz</button>
        </div>

        <!-- Browse Groups Tab -->
        <div id="groups" class="tab-content active">
            <div class="card">
                <h2>Browse Groups by City</h2>
                <div class="form-group">
                    <label>City</label>
                    <select id="citySelect">
                        <option value="San Francisco">San Francisco, CA</option>
                        <option value="Denver">Denver, CO</option>
                        <option value="Washington">Washington, DC</option>
                        <option value="Austin">Austin, TX</option>
                    </select>
                </div>
                <button class="button" onclick="loadGroups()">Load Groups</button>
                <div id="groupsResults" class="results"></div>
            </div>
        </div>

        <!-- Get Recommendations Tab -->
        <div id="recommend" class="tab-content">
            <div class="card">
                <h2>Get Personalized Recommendations</h2>
                <p style="color: #666; margin-bottom: 20px; font-size: 14px;">
                    ‚ú® Now with enhanced matching: embeddings for semantic interest matching, 
                    full personality dimensions, social needs, and motivations!
                </p>
                
                <div class="form-group">
                    <label>Personality Scores (2-14 range)</label>
                    <div class="personality-inputs">
                        <div>
                            <label style="font-size: 14px;">Extraversion</label>
                            <input type="number" id="extraversion" min="2" max="14" value="10" step="1">
                        </div>
                        <div>
                            <label style="font-size: 14px;">Conscientiousness</label>
                            <input type="number" id="conscientiousness" min="2" max="14" value="12" step="1">
                        </div>
                        <div>
                            <label style="font-size: 14px;">Openness</label>
                            <input type="number" id="openness" min="2" max="14" value="8" step="1">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="background: #FFF9F0; padding: 15px; border-radius: 8px; border-left: 3px solid #FF8C42;">
                    <label style="margin-bottom: 10px;">Optional: Social Needs & Motivations</label>
                    <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                        These enhance matching but are optional. Leave empty to use personality + interests only.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div>
                            <label style="font-size: 13px;">Social Needs</label>
                            <input type="number" id="loneliness" min="1" max="5" placeholder="Loneliness (1-5)" style="margin-bottom: 8px;">
                            <input type="number" id="closeFriends" min="0" max="20" placeholder="Close friends count" style="margin-bottom: 8px;">
                            <input type="number" id="socialSatisfaction" min="1" max="7" placeholder="Social satisfaction (1-7)">
                        </div>
                        <div>
                            <label style="font-size: 13px;">Motivations (1-5)</label>
                            <input type="number" id="intrinsic" min="1" max="5" placeholder="Intrinsic" style="margin-bottom: 8px;">
                            <input type="number" id="socialMotivation" min="1" max="5" placeholder="Social" style="margin-bottom: 8px;">
                            <input type="number" id="achievement" min="1" max="5" placeholder="Achievement">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Select Your Interests</label>
                    <p style="font-size: 12px; color: #666; margin-bottom: 12px;">
                        Select interests that match activities you'd like to do with others
                    </p>
                    <div id="interestSelector" style="max-height: 400px; overflow-y: auto; border: 2px solid #e0e0e0; border-radius: 8px; padding: 20px; background: #fafafa;">
                        <!-- Interest categories will be generated here -->
                    </div>
                    <div id="selectedInterests" style="margin-top: 12px; min-height: 40px; padding: 10px; background: #FFF9F0; border-radius: 6px; border-left: 3px solid #FF8C42;">
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px;"><strong>Selected:</strong> <span id="selectedCount">0</span> interests</div>
                        <div id="selectedTags" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label>City</label>
                    <select id="recommendCity">
                        <option value="San Francisco">San Francisco, CA</option>
                        <option value="Denver">Denver, CO</option>
                        <option value="Washington">Washington, DC</option>
                    </select>
                </div>

                <button class="button" onclick="getRecommendations()">Get Recommendations</button>
                <div id="recommendResults" class="results"></div>
            </div>
        </div>

        <!-- Personality Quiz Tab -->
        <div id="personality" class="tab-content">
            <div class="card">
                <h2>Calculate Personality Scores</h2>
                <p style="color: #666; margin-bottom: 20px;">Enter your quiz responses (1-7 scale)</p>
                
                <div class="form-group">
                    <label>Q1 (Extraversion)</label>
                    <input type="number" id="q1" min="1" max="7" value="4">
                </div>
                <div class="form-group">
                    <label>Q6 (Extraversion - reversed)</label>
                    <input type="number" id="q6" min="1" max="7" value="4">
                </div>
                <div class="form-group">
                    <label>Q3 (Conscientiousness)</label>
                    <input type="number" id="q3" min="1" max="7" value="4">
                </div>
                <div class="form-group">
                    <label>Q8 (Conscientiousness - reversed)</label>
                    <input type="number" id="q8" min="1" max="7" value="4">
                </div>
                <div class="form-group">
                    <label>Q5 (Openness)</label>
                    <input type="number" id="q5" min="1" max="7" value="4">
                </div>
                <div class="form-group">
                    <label>Q10 (Openness - reversed)</label>
                    <input type="number" id="q10" min="1" max="7" value="4">
                </div>

                <button class="button" onclick="calculatePersonality()">Calculate Scores</button>
                <div id="personalityResults" class="results"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        async function loadGroups() {
            const city = document.getElementById('citySelect').value;
            const resultsDiv = document.getElementById('groupsResults');
            
            resultsDiv.innerHTML = '<div class="loading">Loading groups...</div>';

            try {
                const response = await fetch(`${API_BASE}/groups?city=${encodeURIComponent(city)}`);
                const data = await response.json();

                if (data.groups && data.groups.length > 0) {
                    let html = `<h3>${data.count} Groups in ${data.city}</h3>`;
                    data.groups.forEach(group => {
                        html += `
                            <div class="group-card">
                                <h3>${group.name}</h3>
                                <p>${group.description}</p>
                                <div>
                                    <span class="badge">${group.member_count} members</span>
                                    <span class="badge">${group.group_size_category || 'N/A'}</span>
                                    <span class="badge">${group.group_type || 'N/A'}</span>
                                </div>
                            </div>
                        `;
                    });
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p style="color: #666;">No groups found. Create test data first using: <code>python scripts/create_test_data.py</code></p>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}. Make sure the API server is running on port 8000.</div>`;
            }
        }

        async function getRecommendations() {
            const resultsDiv = document.getElementById('recommendResults');
            resultsDiv.innerHTML = '<div class="loading">Finding recommendations...</div>';

            const personalityScores = {
                extraversion: parseFloat(document.getElementById('extraversion').value),
                conscientiousness: parseFloat(document.getElementById('conscientiousness').value),
                openness: parseFloat(document.getElementById('openness').value)
            };

            // Get interests from selector
            const interests = getSelectedInterestsArray();
            
            if (interests.length === 0) {
                resultsDiv.innerHTML = '<div class="error">Please select at least one interest</div>';
                return;
            }

            const city = document.getElementById('recommendCity').value;
            
            // Get optional social needs and motivations
            const loneliness = document.getElementById('loneliness').value;
            const closeFriends = document.getElementById('closeFriends').value;
            const socialSatisfaction = document.getElementById('socialSatisfaction').value;
            const intrinsic = document.getElementById('intrinsic').value;
            const socialMotivation = document.getElementById('socialMotivation').value;
            const achievement = document.getElementById('achievement').value;
            
            const requestBody = {
                personality_scores: personalityScores,
                interests: interests,
                city: city
            };
            
            // Add social needs if provided
            if (loneliness || closeFriends || socialSatisfaction) {
                requestBody.social_needs = {};
                if (loneliness) requestBody.social_needs.loneliness_frequency = parseInt(loneliness);
                if (closeFriends) requestBody.social_needs.close_friends_count = parseInt(closeFriends);
                if (socialSatisfaction) requestBody.social_needs.social_satisfaction = parseInt(socialSatisfaction);
            }
            
            // Add motivations if provided
            if (intrinsic || socialMotivation || achievement) {
                requestBody.motivations = {};
                if (intrinsic) requestBody.motivations.intrinsic = parseFloat(intrinsic);
                if (socialMotivation) requestBody.motivations.social = parseFloat(socialMotivation);
                if (achievement) requestBody.motivations.achievement = parseFloat(achievement);
            }

            try {
                const response = await fetch(`${API_BASE}/recommend`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (data.recommendations && data.recommendations.length > 0) {
                    let html = `<h3>${data.count} Recommendations for ${data.city}</h3>`;
                    data.recommendations.forEach(rec => {
                        const score = (rec.scores.final * 100).toFixed(0);
                        const personality = (rec.scores.personality * 100).toFixed(0);
                        const interest = (rec.scores.interest * 100).toFixed(0);
                        const socialNeeds = rec.scores.social_needs ? (rec.scores.social_needs * 100).toFixed(0) : 'N/A';
                        const motivations = rec.scores.motivations ? (rec.scores.motivations * 100).toFixed(0) : 'N/A';
                        
                        // Build personality components breakdown
                        let componentsHtml = '';
                        if (rec.scores.personality_components) {
                            const comps = rec.scores.personality_components;
                            const components = [];
                            if (comps.extraversion !== undefined) components.push(`Extraversion: ${(comps.extraversion * 100).toFixed(0)}%`);
                            if (comps.conscientiousness !== undefined) components.push(`Conscientiousness: ${(comps.conscientiousness * 100).toFixed(0)}%`);
                            if (comps.openness !== undefined) components.push(`Openness: ${(comps.openness * 100).toFixed(0)}%`);
                            if (components.length > 0) {
                                componentsHtml = `<div style="font-size: 11px; color: #666;"><strong>Personality Components:</strong> ${components.join(' ‚Ä¢ ')}</div>`;
                            }
                        }
                        
                        html += `
                            <div class="group-card">
                                <h3>${rec.group.name}</h3>
                                <p>${rec.group.description}</p>
                                <div>
                                    <span class="badge">${rec.group.member_count} members</span>
                                    <span class="score">Match: ${score}%</span>
                                </div>
                                <div style="margin-top: 12px; padding: 12px; background: #F5F5F5; border-radius: 6px; font-size: 12px;">
                                    <strong style="color: #FF8C42; display: block; margin-bottom: 8px;">Score Breakdown:</strong>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                        <div><strong>Personality:</strong> ${personality}%</div>
                                        <div><strong>Interest:</strong> ${interest}%</div>
                                        ${socialNeeds !== 'N/A' ? `<div><strong>Social Needs:</strong> ${socialNeeds}%</div>` : ''}
                                        ${motivations !== 'N/A' ? `<div><strong>Motivations:</strong> ${motivations}%</div>` : ''}
                                    </div>
                                    ${componentsHtml ? `<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #ddd; color: #666;">${componentsHtml}</div>` : ''}
                                </div>
                            </div>
                        `;
                    });
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p style="color: #666;">No recommendations found. Try different personality scores or interests.</p>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}. Make sure the API server is running.</div>`;
            }
        }

        async function calculatePersonality() {
            const resultsDiv = document.getElementById('personalityResults');
            resultsDiv.innerHTML = '<div class="loading">Calculating scores...</div>';

            const quiz = {
                q1: parseInt(document.getElementById('q1').value),
                q6: parseInt(document.getElementById('q6').value),
                q3: parseInt(document.getElementById('q3').value),
                q8: parseInt(document.getElementById('q8').value),
                q5: parseInt(document.getElementById('q5').value),
                q10: parseInt(document.getElementById('q10').value)
            };

            try {
                const response = await fetch(`${API_BASE}/personality-quiz`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(quiz)
                });

                const data = await response.json();

                if (data.success) {
                    const scores = data.personality_scores;
                    let html = `
                        <h3>Your Personality Scores</h3>
                        <div class="group-card">
                            <p><strong>Extraversion:</strong> ${scores.extraversion} (${scores.categories.extraversion})</p>
                            <p><strong>Conscientiousness:</strong> ${scores.conscientiousness} (${scores.categories.conscientiousness})</p>
                            <p><strong>Openness:</strong> ${scores.openness} (${scores.categories.openness})</p>
                        </div>
                    `;
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<div class="error">Error calculating scores</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Interest categories data
        const interestCategories = {
            sports: { label: "Sports & Fitness", icon: "üèÉ", interests: ["running", "cycling", "yoga", "tennis", "basketball", "soccer", "swimming", "martial arts", "dance fitness", "boxing", "volleyball"] },
            outdoor: { label: "Outdoor & Nature", icon: "üå≤", interests: ["hiking", "biking", "rock climbing", "kayaking", "gardening", "walking tours", "park activities"] },
            arts: { label: "Arts & Culture", icon: "üé®", interests: ["painting", "photography", "pottery", "crafts", "writing", "theater", "museums", "film"] },
            music: { label: "Music & Performance", icon: "üéµ", interests: ["concerts", "live music", "singing", "playing instruments", "music festivals", "open mic", "jazz"] },
            food: { label: "Food & Dining", icon: "üçΩÔ∏è", interests: ["cooking classes", "wine tasting", "food tours", "restaurants", "baking", "coffee", "breweries"] },
            learning: { label: "Learning & Development", icon: "üìö", interests: ["book clubs", "workshops", "lectures", "language exchange", "tech meetups", "professional development", "science"] },
            social: { label: "Social & Networking", icon: "üéâ", interests: ["networking", "social mixers", "trivia", "comedy", "happy hours", "bars", "events"] },
            games: { label: "Games & Hobbies", icon: "üéÆ", interests: ["board games", "card games", "chess", "puzzles", "video games", "dnd"] },
            wellness: { label: "Wellness & Mindfulness", icon: "üßò", interests: ["meditation", "mindfulness", "yoga", "tai chi", "wellness workshops", "therapy groups"] },
            community: { label: "Volunteering & Community", icon: "ü§ù", interests: ["volunteering", "charity", "environmental", "mentoring", "community organizing", "activism"] }
        };

        let selectedInterests = new Set();

        function initializeInterestSelector() {
            const container = document.getElementById('interestSelector');
            let html = '';
            
            for (const [key, category] of Object.entries(interestCategories)) {
                html += `
                    <div style="margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid #e8e8e8;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; font-weight: 600; color: #FF8C42; font-size: 15px;">
                                <span style="font-size: 20px; margin-right: 8px;">${category.icon}</span>
                                <span>${category.label}</span>
                            </div>
                            <div style="display: flex; gap: 6px;">
                                <button type="button" onclick="toggleCategory('${key}', true)" 
                                        style="font-size: 11px; padding: 4px 10px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; color: #666;">
                                    Select All
                                </button>
                                <button type="button" onclick="toggleCategory('${key}', false)" 
                                        style="font-size: 11px; padding: 4px 10px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; color: #666;">
                                    Clear
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                `;
                
                category.interests.forEach(interest => {
                    const isDefault = interest === 'running' || interest === 'fitness';
                    html += `
                        <label class="interest-tag" data-interest="${interest}" data-category="${key}"
                               style="display: inline-flex; align-items: center; padding: 8px 14px; background: white; border: 2px solid #e0e0e0; border-radius: 20px; cursor: pointer; font-size: 13px; transition: all 0.2s; user-select: none; font-weight: 500;" 
                               onmouseover="if(!this.classList.contains('selected')) { this.style.borderColor='#FF8C42'; this.style.background='#FFF9F0'; }" 
                               onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#e0e0e0'; this.style.background='white'; }">
                            <input type="checkbox" value="${interest}" 
                                   data-category="${key}"
                                   onchange="toggleInterestTag(this)" 
                                   style="margin-right: 8px; cursor: pointer; width: 16px; height: 16px;"
                                   ${isDefault ? 'checked' : ''}>
                            <span>${interest}</span>
                        </label>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            updateSelectedInterests(); // Initialize with default selections
            updateInterestTagStyles(); // Apply initial styling
        }

        function toggleInterestTag(checkbox) {
            const label = checkbox.closest('.interest-tag');
            if (checkbox.checked) {
                label.classList.add('selected');
                label.style.background = '#FF8C42';
                label.style.borderColor = '#FF8C42';
                label.style.color = 'white';
            } else {
                label.classList.remove('selected');
                label.style.background = 'white';
                label.style.borderColor = '#e0e0e0';
                label.style.color = '#333';
            }
            updateSelectedInterests();
        }

        function updateInterestTagStyles() {
            document.querySelectorAll('.interest-tag input[type="checkbox"]').forEach(checkbox => {
                if (checkbox.checked) {
                    toggleInterestTag(checkbox);
                }
            });
        }

        function toggleCategory(categoryKey, select) {
            const checkboxes = document.querySelectorAll(`.interest-tag[data-category="${categoryKey}"] input[type="checkbox"]`);
            checkboxes.forEach(cb => {
                cb.checked = select;
                toggleInterestTag(cb);
            });
        }

        function updateSelectedInterests() {
            const checkboxes = document.querySelectorAll('#interestSelector input[type="checkbox"]');
            selectedInterests.clear();
            
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    selectedInterests.add(cb.value);
                }
            });
            
            // Update count
            const count = selectedInterests.size;
            document.getElementById('selectedCount').textContent = count;
            
            // Update selected tags display
            const tagsContainer = document.getElementById('selectedTags');
            if (count === 0) {
                tagsContainer.innerHTML = '<span style="color: #999; font-size: 12px; font-style: italic;">No interests selected - please select at least one</span>';
            } else {
                tagsContainer.innerHTML = Array.from(selectedInterests).sort().map(interest => 
                    `<span style="display: inline-block; padding: 5px 12px; background: #FF8C42; color: white; border-radius: 12px; font-size: 11px; font-weight: 500; margin: 2px;">${interest}</span>`
                ).join('');
            }
        }

        function getSelectedInterestsArray() {
            return Array.from(selectedInterests);
        }

        // Load groups on page load
        window.addEventListener('load', () => {
            loadGroups();
            initializeInterestSelector();
        });
    </script>
</body>
</html>

