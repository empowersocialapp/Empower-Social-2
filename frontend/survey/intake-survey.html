<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empower - Intake Survey</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #FFF5EB 0%, #FFE8D6 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 40px 20px;
        }

        /* Header */
        .header {
            max-width: 800px;
            margin: 0 auto 40px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FF8C42 0%, #FFA566 100%);
            border-radius: 8px;
        }

        .logo h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            color: #FF8C42;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .tagline {
            color: #666;
            font-size: 14px;
            font-style: italic;
            margin-left: 52px;
            margin-top: -8px;
            font-weight: 400;
            letter-spacing: 0.3px;
        }

        /* Survey Container */
        .survey-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 32px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #FF8C42 0%, #FFA566 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 14px;
            color: #666;
            text-align: center;
        }

        /* Page System */
        .survey-page {
            display: none;
        }

        .survey-page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-header h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 32px;
            color: #2C2C2C;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #666;
            font-size: 16px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 15px;
        }

        .required {
            color: #E65100;
            margin-left: 2px;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
            background: white;
            color: #333;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #FF8C42;
            box-shadow: 0 0 0 3px rgba(255, 140, 66, 0.1);
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }

        /* Checkbox Group */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f9f9f9;
            border: 2px solid #f0f0f0;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-item:hover {
            background: #FFF9F0;
            border-color: #FFE8D6;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #FF8C42;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 400;
            font-size: 15px;
        }

        /* Interest Category Styling */
        .interest-category {
            margin-bottom: 32px;
        }

        .interest-category h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 20px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #FFE8D6;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        /* Welcome Page Styles */
        .welcome-hero {
            text-align: center;
            margin-bottom: 48px;
        }

        .welcome-section {
            margin-bottom: 32px;
        }

        .welcome-privacy {
            margin-bottom: 32px;
        }

        /* Range Slider Styles */
        .slider-container {
            margin-bottom: 32px;
            padding-bottom: 32px;
            border-bottom: 1px solid #f0f0f0;
        }

        .slider-container:last-child {
            border-bottom: none;
        }

        .slider-label {
            font-size: 15px;
            color: #333;
            font-weight: 500;
            margin-bottom: 20px;
            display: block;
        }

        .slider-wrapper {
            position: relative;
            padding: 0 10px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #f0f0f0;
            outline: none;
            -webkit-appearance: none;
            margin: 15px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF8C42 0%, #FFA566 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(255, 140, 66, 0.3);
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 140, 66, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF8C42 0%, #FFA566 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(255, 140, 66, 0.3);
            transition: all 0.3s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 140, 66, 0.5);
        }

        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: linear-gradient(to right, 
                #f0f0f0 0%, 
                #FFE8D6 50%, 
                #FF8C42 100%);
            border-radius: 5px;
        }

        input[type="range"]::-moz-range-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: linear-gradient(to right, 
                #f0f0f0 0%, 
                #FFE8D6 50%, 
                #FF8C42 100%);
            border-radius: 5px;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }

        .slider-labels span {
            font-size: 12px;
            color: #888;
            font-style: italic;
        }

        .slider-value {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: #FF8C42;
            margin-top: 8px;
            min-height: 24px;
        }

        /* Section Header */
        .section-header {
            margin: 40px 0 24px;
            padding-top: 40px;
            border-top: 2px solid #f0f0f0;
        }

        .section-header h3 {
            font-size: 24px;
            color: #2C2C2C;
            margin-bottom: 8px;
        }

        .section-subtitle {
            color: #666;
            font-size: 14px;
        }

        .personality-intro {
            background: linear-gradient(135deg, #FFF9F0 0%, #FFE8D6 100%);
            border-left: 3px solid #FF8C42;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .personality-intro p {
            margin: 0;
            font-size: 15px;
            color: #333;
        }

        /* Likert Scale Styles */
        .likert-group {
            margin-bottom: 32px;
        }

        .likert-item {
            margin-bottom: 32px;
            padding-bottom: 32px;
            border-bottom: 1px solid #f0f0f0;
        }

        .likert-item:last-child {
            border-bottom: none;
        }

        .likert-label {
            font-size: 15px;
            color: #333;
            font-weight: 500;
            margin-bottom: 16px;
            display: block;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 8px;
        }

        .likert-scale.likert-5 {
            max-width: 500px;
        }

        .likert-option {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .likert-option input[type="radio"] {
            width: 20px;
            height: 20px;
            margin: 0;
            cursor: pointer;
            accent-color: #FF8C42;
        }

        .likert-option label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
            cursor: pointer;
            margin: 0;
        }

        .likert-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
        }

        .likert-labels span {
            font-size: 12px;
            color: #888;
            font-style: italic;
        }

        /* Button Styles */
        .button-group {
            margin-top: 35px;
            display: flex;
            gap: 12px;
        }

        button {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
            letter-spacing: 0.3px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF8C42 0%, #FFA566 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #FF7A2E 0%, #FF9552 100%);
            transform: scale(1.02);
        }

        /* Recommendations Card Styles */
        .recommendations-header {
            max-width: 1400px;
            margin: 0 auto 32px;
            background: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .recommendations-header h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 32px;
            color: #2C2C2C;
            margin-bottom: 12px;
        }

        .recommendations-grid {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 24px;
        }

        .event-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .event-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .event-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
            background-color: #f0f0f0;
        }

        .event-type-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .event-type-badge.recurring {
            background: #4CAF50;
            color: white;
        }

        .event-type-badge.one-time {
            background: #2196F3;
            color: white;
        }

        .match-score-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: white;
            color: #FF8C42;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .event-content {
            padding: 24px;
        }

        .event-content h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 20px;
            color: #2C2C2C;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .event-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #666;
        }

        .event-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .match-reasons {
            background: #FFF9F0;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .match-reasons h4 {
            font-size: 14px;
            color: #FF8C42;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .match-reasons ul {
            list-style: none;
            padding: 0;
        }

        .match-reasons li {
            font-size: 13px;
            color: #555;
            margin-bottom: 4px;
            padding-left: 16px;
            position: relative;
        }

        .match-reasons li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
        }

        .event-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge.newcomer {
            background: #E8F5E9;
            color: #2E7D32;
        }

        .badge.small-group {
            background: #E3F2FD;
            color: #1565C0;
        }

        .badge.free {
            background: #F3E5F5;
            color: #6A1B9A;
        }

        .event-actions {
            display: flex;
            gap: 12px;
        }

        .event-actions .btn-primary {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: inline-block;
        }

        .event-actions .btn-secondary {
            padding: 12px 20px;
            background: #f5f5f5;
            color: #666;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .event-actions .btn-secondary:hover {
            background: #e8e8e8;
        }

        @media (max-width: 768px) {
            .recommendations-grid {
                grid-template-columns: 1fr;
            }
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e8e8e8;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .survey-container {
                padding: 30px 24px;
            }

            .page-header h2 {
                font-size: 28px;
            }

            .likert-scale {
                gap: 4px;
            }

            .likert-option label {
                font-size: 13px;
            }

            .likert-labels span {
                font-size: 11px;
            }

            .welcome-hero h2 {
                font-size: 28px;
            }

            .welcome-section div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 20px;
            }

            .survey-container {
                padding: 24px 20px;
            }

            .logo h1 {
                font-size: 24px;
            }

            .page-header h2 {
                font-size: 24px;
            }

            .section-header h3 {
                font-size: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .likert-scale {
                gap: 2px;
            }

            .likert-option input[type="radio"] {
                width: 18px;
                height: 18px;
            }

            .likert-option label {
                font-size: 12px;
            }

            .likert-labels {
                flex-direction: column;
                gap: 4px;
            }

            .likert-labels span:last-child {
                text-align: right;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <div class="logo-icon"></div>
            <h1>Empower</h1>
        </div>
        <p class="tagline">Less Scrolling. More Living.</p>
    </div>

    <div class="survey-container">
        <!-- Progress Bar -->
        <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 12.5%"></div>
            </div>
            <div class="progress-text" id="progressText">Page 1 of 8</div>
        </div>

        <form id="intakeForm">
            <!-- Welcome Page -->
            <div class="survey-page active" id="pageWelcome">
                <div class="welcome-hero">
                    <h2 style="font-family: 'Montserrat', sans-serif; font-size: 36px; color: #2C2C2C; margin-bottom: 16px;">Welcome to Empower</h2>
                    <p style="font-size: 18px; color: #666; margin-bottom: 24px; line-height: 1.6;">
                        We're here to help you find activities and communities that truly match who you are, not just what you like.
                    </p>
                    <p style="font-size: 16px; color: #555; margin-bottom: 32px; line-height: 1.7;">
                        Empower uses scientifically-validated social psychology assessments to drive more meaningful social recommendations. 
                        By understanding your personality, social needs, and motivations, we can connect you with events and communities 
                        where you'll truly thrive.
                    </p>
                    
                    <div style="display: flex; gap: 32px; justify-content: center; margin-bottom: 48px; font-size: 14px; color: #888;">
                        <span>About 5 minutes</span>
                        <span>â€¢</span>
                        <span>8 sections</span>
                        <span>â€¢</span>
                        <span>Completely private</span>
                    </div>
                </div>

                <div class="welcome-section">
                    <h3 style="font-family: 'Montserrat', sans-serif; font-size: 20px; margin-bottom: 16px; color: #2C2C2C;">What We'll Ask About</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 32px;">
                        <div style="display: flex; gap: 12px;">
                            <span style="color: #FF8C42; font-weight: 600;">âœ“</span>
                            <span style="font-size: 15px; color: #555;">Your personality style and preferences</span>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <span style="color: #FF8C42; font-weight: 600;">âœ“</span>
                            <span style="font-size: 15px; color: #555;">Your interests and favorite activities</span>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <span style="color: #FF8C42; font-weight: 600;">âœ“</span>
                            <span style="font-size: 15px; color: #555;">Your social connections and goals</span>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <span style="color: #FF8C42; font-weight: 600;">âœ“</span>
                            <span style="font-size: 15px; color: #555;">Communities you'd like to connect with</span>
                        </div>
                    </div>
                </div>

                <div class="welcome-section">
                    <h3 style="font-family: 'Montserrat', sans-serif; font-size: 20px; margin-bottom: 16px; color: #2C2C2C;">Why These Questions Matter</h3>
                    <p style="font-size: 15px; color: #555; line-height: 1.8; margin-bottom: 24px;">
                        Unlike other event platforms that only ask what you like, we want to understand who you are. 
                        This helps us recommend small group activities for introverts, recurring communities for people 
                        seeking connection, and events that match your motivation, whether that's having fun, building 
                        skills, or making friends.
                    </p>
                </div>

                <div class="welcome-privacy">
                    <div style="display: flex; gap: 16px; align-items: start; background: #F0F7FF; padding: 20px; border-radius: 12px; border-left: 3px solid #2196F3;">
                        <span style="font-size: 24px;">ðŸ”’</span>
                        <div>
                            <h4 style="font-family: 'Montserrat', sans-serif; font-size: 16px; margin-bottom: 8px; color: #2C2C2C;">Your Privacy is Protected</h4>
                            <p style="font-size: 14px; color: #555; line-height: 1.6; margin: 0;">
                                Your responses are private and secure. We never share your information without permission,
                                and all data is used only to find events you'll love. You can skip any question you're
                                uncomfortable with.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="button-group" style="margin-top: 40px;">
                    <button type="button" class="btn-primary" onclick="startSurvey()" style="flex: none; padding: 16px 48px; font-size: 18px;">Get Started</button>
                </div>

                <!-- Returning User Section -->
                <div style="text-align: center; margin-top: 32px; padding-top: 32px; border-top: 1px solid #e0e0e0;">
                    <h3 style="font-family: 'Montserrat', sans-serif; font-size: 18px; margin-bottom: 12px; color: #2C2C2C;">Already taken the survey?</h3>
                    <p style="font-size: 14px; color: #666; margin-bottom: 20px;">Log in with your username to view your recommendations</p>

                    <div id="loginSection" style="max-width: 400px; margin: 0 auto;">
                        <div style="margin-bottom: 16px;">
                            <input
                                type="text"
                                id="loginUsername"
                                placeholder="Enter your username"
                                style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px;"
                            >
                        </div>
                        <div id="loginError" style="display: none; background: #fee; color: #c33; padding: 10px; border-radius: 6px; margin-bottom: 12px; font-size: 14px;"></div>
                        <button
                            type="button"
                            class="btn-secondary"
                            onclick="loginUser()"
                            id="loginButton"
                            style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                            Access My Recommendations
                        </button>
                    </div>
                </div>
            </div>

            <!-- Page 1: Basic Information -->
            <div class="survey-page" id="page1">
                <div class="page-header">
                    <h2>Basic Information</h2>
                    <p class="subtitle">Let's start with some basic details about you</p>
                </div>

                <div class="form-group">
                    <label for="firstName">First Name <span class="required">*</span></label>
                    <input type="text" id="firstName" name="firstName">
                </div>

                <div class="form-group">
                    <label for="username">Username <span class="required">*</span></label>
                    <input type="text" id="username" name="username" pattern="[a-zA-Z0-9_-]+" minlength="3" maxlength="20">
                    <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">Create a unique username (3-20 characters, letters, numbers, - or _). You'll use this to log back in.</small>
                </div>

                <div class="form-group">
                    <label for="email">Email <span class="required">*</span></label>
                    <input type="email" id="email" name="email">
                </div>

                <div class="form-group">
                    <label for="age">Age <span class="required">*</span></label>
                    <input type="number" id="age" name="age" min="1" max="120">
                </div>

                <div class="form-group">
                    <label for="gender">Gender <span class="required">*</span></label>
                    <select id="gender" name="gender">
                        <option value="">-- Please select --</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="non-binary">Non-binary</option>
                        <option value="prefer-not-to-say">Prefer not to say</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="zipcode">Zip Code <span class="required">*</span></label>
                    <input type="text" id="zipcode" name="zipcode" pattern="[0-9]{5}" maxlength="5">
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="clearForm()">Clear</button>
                    <button type="button" class="btn-primary" onclick="nextPage(1)">Continue</button>
                </div>
            </div>

            <!-- Page 2: Personality Assessment -->
            <div class="survey-page" id="page2">
                <div class="page-header">
                    <h2>Section 1: Personality Assessment</h2>
                    <p class="subtitle">Please rate how well each statement describes you (approximately 90 seconds)</p>
                </div>

                                <div class="personality-intro">
                    <p><strong>I see myself as:</strong></p>
                </div>

                <div class="likert-group">
                    <div class="slider-container">
                        <label class="slider-label">1. Extraverted, enthusiastic</label>
                        <div class="slider-wrapper">
                            <input type="range" name="q1" id="q1" min="1" max="7" value="4" step="1" oninput="updateSliderValue('q1', this.value)">
                            <div class="slider-value" id="q1-value">4</div>
                        </div>
                        <div class="slider-labels">
                            <span>Disagree Strongly</span>
                            <span>Agree Strongly</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">2. Reserved, quiet</label>
                        <div class="slider-wrapper">
                            <input type="range" name="q6" id="q6" min="1" max="7" value="4" step="1" oninput="updateSliderValue('q6', this.value)">
                            <div class="slider-value" id="q6-value">4</div>
                        </div>
                        <div class="slider-labels">
                            <span>Disagree Strongly</span>
                            <span>Agree Strongly</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">3. Dependable, self-disciplined</label>
                        <div class="slider-wrapper">
                            <input type="range" name="q3" id="q3" min="1" max="7" value="4" step="1" oninput="updateSliderValue('q3', this.value)">
                            <div class="slider-value" id="q3-value">4</div>
                        </div>
                        <div class="slider-labels">
                            <span>Disagree Strongly</span>
                            <span>Agree Strongly</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">4. Disorganized, careless</label>
                        <div class="slider-wrapper">
                            <input type="range" name="q8" id="q8" min="1" max="7" value="4" step="1" oninput="updateSliderValue('q8', this.value)">
                            <div class="slider-value" id="q8-value">4</div>
                        </div>
                        <div class="slider-labels">
                            <span>Disagree Strongly</span>
                            <span>Agree Strongly</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">5. Open to new experiences, complex</label>
                        <div class="slider-wrapper">
                            <input type="range" name="q5" id="q5" min="1" max="7" value="4" step="1" oninput="updateSliderValue('q5', this.value)">
                            <div class="slider-value" id="q5-value">4</div>
                        </div>
                        <div class="slider-labels">
                            <span>Disagree Strongly</span>
                            <span>Agree Strongly</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">6. Conventional, uncreative</label>
                        <div class="slider-wrapper">
                            <input type="range" name="q10" id="q10" min="1" max="7" value="4" step="1" oninput="updateSliderValue('q10', this.value)">
                            <div class="slider-value" id="q10-value">4</div>
                        </div>
                        <div class="slider-labels">
                            <span>Disagree Strongly</span>
                            <span>Agree Strongly</span>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevPage(2)">Back</button>
                    <button type="button" class="btn-primary" onclick="nextPage(2)">Continue</button>
                </div>
            </div>

            <!-- Page 3: Social Connection Assessment -->
            <div class="survey-page" id="page3">
                <div class="page-header">
                    <h2>Section 2: Social Connection</h2>
                    <p class="subtitle">Help us understand your social connections and satisfaction</p>
                </div>

                <div class="form-group">
                    <label for="closeFriends">1. How many close friends would you say you have?</label>
                    <input type="number" id="closeFriends" name="closeFriends" min="0" max="999" placeholder="Enter a number">
                </div>

                <div class="likert-group">
                    <div class="slider-container">
                        <label class="slider-label">2. How often do you feel lonely?</label>
                        <div class="slider-wrapper">
                            <input type="range" name="loneliness" id="loneliness" min="1" max="5" value="3" step="1" oninput="updateLonelinessLabel(this.value)">
                            <div class="slider-value" id="loneliness-value">Sometimes</div>
                        </div>
                        <div class="slider-labels">
                            <span>Never</span>
                            <span>Very Often</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">3. How satisfied are you with your current social relationships?</label>
                        <div class="slider-wrapper">
                            <input type="range" name="socialSatisfaction" id="socialSatisfaction" min="1" max="7" value="4" step="1" oninput="updateSliderValue('socialSatisfaction', this.value)">
                            <div class="slider-value" id="socialSatisfaction-value">4</div>
                        </div>
                        <div class="slider-labels">
                            <span>Very Dissatisfied</span>
                            <span>Very Satisfied</span>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevPage(3)">Back</button>
                    <button type="button" class="btn-primary" onclick="nextPage(3)">Continue</button>
                </div>
            </div>

            <!-- Page 4: Core Motivation -->
            <div class="survey-page" id="page4">
                <div class="page-header">
                    <h2>Section 3: Core Motivation</h2>
                    <p class="subtitle">Tell us why you participate in social activities (approximately 90 seconds)</p>
                </div>

                <div class="personality-intro">
                    <p><strong>I participate in social activities because...</strong></p>
                </div>

                <div class="likert-group">
                    <div class="slider-container">
                        <label class="slider-label">1. I find them genuinely enjoyable and fun</label>
                        <div class="slider-wrapper">
                            <input type="range" name="m1" id="m1" min="1" max="5" value="3" step="1" oninput="updateSliderValue('m1', this.value)">
                            <div class="slider-value" id="m1-value">3</div>
                        </div>
                        <div class="slider-labels">
                            <span>Not at all true</span>
                            <span>Completely true</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">2. I want to spend time with people I care about</label>
                        <div class="slider-wrapper">
                            <input type="range" name="m2" id="m2" min="1" max="5" value="3" step="1" oninput="updateSliderValue('m2', this.value)">
                            <div class="slider-value" id="m2-value">3</div>
                        </div>
                        <div class="slider-labels">
                            <span>Not at all true</span>
                            <span>Completely true</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">3. They help me develop new skills and abilities</label>
                        <div class="slider-wrapper">
                            <input type="range" name="m3" id="m3" min="1" max="5" value="3" step="1" oninput="updateSliderValue('m3', this.value)">
                            <div class="slider-value" id="m3-value">3</div>
                        </div>
                        <div class="slider-labels">
                            <span>Not at all true</span>
                            <span>Completely true</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">4. I feel energized and engaged when participating</label>
                        <div class="slider-wrapper">
                            <input type="range" name="m4" id="m4" min="1" max="5" value="3" step="1" oninput="updateSliderValue('m4', this.value)">
                            <div class="slider-value" id="m4-value">3</div>
                        </div>
                        <div class="slider-labels">
                            <span>Not at all true</span>
                            <span>Completely true</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">5. Meeting new people is important to me</label>
                        <div class="slider-wrapper">
                            <input type="range" name="m5" id="m5" min="1" max="5" value="3" step="1" oninput="updateSliderValue('m5', this.value)">
                            <div class="slider-value" id="m5-value">3</div>
                        </div>
                        <div class="slider-labels">
                            <span>Not at all true</span>
                            <span>Completely true</span>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label class="slider-label">6. I enjoy challenging myself in new situations</label>
                        <div class="slider-wrapper">
                            <input type="range" name="m6" id="m6" min="1" max="5" value="3" step="1" oninput="updateSliderValue('m6', this.value)">
                            <div class="slider-value" id="m6-value">3</div>
                        </div>
                        <div class="slider-labels">
                            <span>Not at all true</span>
                            <span>Completely true</span>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevPage(4)">Back</button>
                    <button type="button" class="btn-primary" onclick="nextPage(4)">Continue</button>
                </div>
            </div>

            <!-- Page 5: Interest Categories (Broad) -->
            <div class="survey-page" id="page5">
                <div class="page-header">
                    <h2>Section 4: Your Interests</h2>
                    <p class="subtitle">Select the areas that interest you (we'll get more specific next)</p>
                </div>

                <div class="form-group">
                    <label><strong>Which areas interest you?</strong> (Select all that apply)</label>
                    <div class="checkbox-group" id="broad-categories">
                        <!-- Generated dynamically -->
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevPage(5)">Back</button>
                    <button type="button" class="btn-primary" onclick="nextPage(5)">Continue</button>
                </div>
            </div>

            <!-- Page 6: Specific Interests -->
            <div class="survey-page" id="page6">
                <div class="page-header">
                    <h2>Section 4: Your Interests (Continued)</h2>
                    <p class="subtitle">All items are pre-selected - uncheck any that don't interest you</p>
                </div>

                <div id="specific-interests-container">
                    <!-- Generated dynamically based on selected categories -->
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevPage(6)">Back</button>
                    <button type="button" class="btn-primary" onclick="nextPage(6)">Continue</button>
                </div>
            </div>

            <!-- Page 7: Activity Preferences -->
            <div class="survey-page" id="page7">
                <div class="page-header">
                    <h2>Section 5: Activity Preferences</h2>
                    <p class="subtitle">Help us understand your availability and preferences</p>
                </div>

                <div class="form-group">
                    <label for="freeTime">1. How much free time do you typically have per week?</label>
                    <select id="freeTime" name="freeTime">
                        <option value="">-- Please select --</option>
                        <option value="<5">Less than 5 hours</option>
                        <option value="5-10">5-10 hours</option>
                        <option value="10-20">10-20 hours</option>
                        <option value=">20">More than 20 hours</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="travelDistance">2. How far are you typically willing to travel for social activities?</label>
                    <select id="travelDistance" name="travelDistance">
                        <option value="">-- Please select --</option>
                        <option value="<1">Less than 1 mile</option>
                        <option value="1-5">1-5 miles</option>
                        <option value="5-15">5-15 miles</option>
                        <option value="15+">15+ miles</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>3. Which setting do you generally prefer? (Select all that apply)</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-indoor" name="preferences" value="indoor">
                            <label for="pref-indoor">Indoor activities</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-outdoor" name="preferences" value="outdoor">
                            <label for="pref-outdoor">Outdoor activities</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-physical" name="preferences" value="physical">
                            <label for="pref-physical">Physical/active</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-relaxed" name="preferences" value="relaxed">
                            <label for="pref-relaxed">Relaxed/low-key</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-structured" name="preferences" value="structured">
                            <label for="pref-structured">Structured events</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-spontaneous" name="preferences" value="spontaneous">
                            <label for="pref-spontaneous">Spontaneous gatherings</label>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevPage(7)">Back</button>
                    <button type="button" class="btn-primary" onclick="nextPage(7)">Continue</button>
                </div>
            </div>

            <!-- Page 8: Community Connections (Affinity Groups) -->
            <div class="survey-page" id="page8">
                <div class="page-header">
                    <h2>Section 6: Community Connections <span style="font-size: 16px; color: #999; font-weight: 400;">(Optional)</span></h2>
                    <p class="subtitle">Looking for communities where you feel understood and welcome? This section is completely optional.</p>
                </div>

                <div class="personality-intro" style="background: #F0F7FF; border-left-color: #2196F3;">
                    <p style="font-size: 14px;">ðŸ”’ <strong>Privacy:</strong> Your selections are private and used only to find relevant communities. We never share this information without your permission.</p>
                </div>

                <div class="affinity-section">
                    <!-- Faith-based Communities -->
                    <div class="affinity-category">
                        <div class="checkbox-item" style="margin-bottom: 12px;">
                            <input type="checkbox" id="affinity-faith" class="affinity-main" data-category="faith">
                            <label for="affinity-faith" style="font-weight: 600; font-size: 16px;">Faith-based or spiritual communities</label>
                        </div>
                        <div id="faith-options" class="affinity-options" style="display: none; margin-left: 32px; margin-bottom: 20px;">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="christian-protestant">
                                    <label>Christian</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="catholic">
                                    <label>Catholic</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="jewish">
                                    <label>Jewish</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="muslim">
                                    <label>Muslim</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="hindu">
                                    <label>Hindu</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="buddhist">
                                    <label>Buddhist</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="lds">
                                    <label>Latter-day Saints (Mormon)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="spiritual">
                                    <label>Spiritual (non-religious)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="atheist-agnostic">
                                    <label>Atheist/Agnostic</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-faith-specific" value="other-faith">
                                    <label>Other faith</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- LGBTQ+ Communities -->
                    <div class="affinity-category">
                        <div class="checkbox-item" style="margin-bottom: 12px;">
                            <input type="checkbox" id="affinity-lgbtq" class="affinity-main" data-category="lgbtq">
                            <label for="affinity-lgbtq" style="font-weight: 600; font-size: 16px;">LGBTQ+ communities</label>
                        </div>
                        <div id="lgbtq-options" class="affinity-options" style="display: none; margin-left: 32px; margin-bottom: 20px;">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-lgbtq-specific" value="gay-men">
                                    <label>Gay men's communities</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-lgbtq-specific" value="lesbian">
                                    <label>Lesbian communities</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-lgbtq-specific" value="bisexual">
                                    <label>Bisexual/Pansexual communities</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-lgbtq-specific" value="transgender">
                                    <label>Transgender communities</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-lgbtq-specific" value="queer-nonbinary">
                                    <label>Queer/Non-binary communities</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-lgbtq-specific" value="general-lgbtq">
                                    <label>General LGBTQ+ inclusive spaces</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cultural/Ethnic Heritage -->
                    <div class="affinity-category">
                        <div class="checkbox-item" style="margin-bottom: 12px;">
                            <input type="checkbox" id="affinity-cultural" class="affinity-main" data-category="cultural">
                            <label for="affinity-cultural" style="font-weight: 600; font-size: 16px;">Cultural or ethnic heritage groups</label>
                        </div>
                        <div id="cultural-options" class="affinity-options" style="display: none; margin-left: 32px; margin-bottom: 20px;">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-cultural-specific" value="african-american">
                                    <label>African American</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-cultural-specific" value="asian-american">
                                    <label>Asian American</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-cultural-specific" value="hispanic-latino">
                                    <label>Hispanic/Latino</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-cultural-specific" value="native-american">
                                    <label>Indigenous/Native American</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-cultural-specific" value="middle-eastern">
                                    <label>Middle Eastern</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-cultural-specific" value="multiracial">
                                    <label>Multicultural</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-cultural-specific" value="international-students">
                                    <label>International students</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-cultural-specific" value="other-cultural">
                                    <label>Other</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Women's Groups -->
                    <div class="affinity-category">
                        <div class="checkbox-item" style="margin-bottom: 12px;">
                            <input type="checkbox" id="affinity-womens" class="affinity-main" data-category="womens">
                            <label for="affinity-womens" style="font-weight: 600; font-size: 16px;">Women's groups and networks</label>
                        </div>
                        <div id="womens-options" class="affinity-options" style="display: none; margin-left: 32px; margin-bottom: 20px;">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-womens-specific" value="professional-women">
                                    <label>Professional women</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-womens-specific" value="women-entrepreneurs">
                                    <label>Women entrepreneurs</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-womens-specific" value="moms">
                                    <label>Moms/Parents</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-womens-specific" value="women-40-plus">
                                    <label>Women 40+</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-womens-specific" value="women-in-stem">
                                    <label>Women in STEM</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Young Professionals -->
                    <div class="affinity-category">
                        <div class="checkbox-item" style="margin-bottom: 12px;">
                            <input type="checkbox" id="affinity-young-prof" class="affinity-main" data-category="young-prof">
                            <label for="affinity-young-prof" style="font-weight: 600; font-size: 16px;">Young professionals (20s-30s)</label>
                        </div>
                        <div id="young-prof-options" class="affinity-options" style="display: none; margin-left: 32px; margin-bottom: 20px;">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-young-prof-specific" value="young-prof-20s">
                                    <label>Young professionals (20s)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-young-prof-specific" value="young-prof-30s">
                                    <label>Young professionals (30s)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-young-prof-specific" value="career-changers">
                                    <label>Career changers</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-young-prof-specific" value="recent-grads">
                                    <label>Recent grads</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- International/Immigrant -->
                    <div class="affinity-category">
                        <div class="checkbox-item" style="margin-bottom: 12px;">
                            <input type="checkbox" id="affinity-international" class="affinity-main" data-category="international">
                            <label for="affinity-international" style="font-weight: 600; font-size: 16px;">International or immigrant communities</label>
                        </div>
                        <div id="international-options" class="affinity-options" style="display: none; margin-left: 32px; margin-bottom: 20px;">
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-international-specific" value="expats">
                                    <label>Expats</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-international-specific" value="recent-immigrants">
                                    <label>Recent immigrants</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-international-specific" value="general-international">
                                    <label>International community</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="affinity-international-specific" value="language-learners">
                                    <label>Language learners</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="personality-intro" style="margin-top: 24px;">
                    <p style="font-size: 13px; color: #666;"><strong>Note:</strong> About 30% of your recommendations will include these communities when they match your interests. We'll still show you 70% general events based on your preferences.</p>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevPage(8)">Back</button>
                    <button type="submit" class="btn-primary">Submit</button>
                </div>
            </div>

            <!-- End of form -->
            <div class="survey-page" id="page7">
                <div class="page-header">
                    <h2>Section 5: Activity Preferences</h2>
                    <p class="subtitle">Help us understand your availability and preferences</p>
                </div>

                <div class="form-group">
                    <label for="freeTime">1. How much free time do you typically have per week?</label>
                    <select id="freeTime" name="freeTime">
                        <option value="">-- Please select --</option>
                        <option value="<5">Less than 5 hours</option>
                        <option value="5-10">5-10 hours</option>
                        <option value="10-20">10-20 hours</option>
                        <option value=">20">More than 20 hours</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="travelDistance">2. How far are you typically willing to travel for social activities?</label>
                    <select id="travelDistance" name="travelDistance">
                        <option value="">-- Please select --</option>
                        <option value="<1">Less than 1 mile</option>
                        <option value="1-5">1-5 miles</option>
                        <option value="5-15">5-15 miles</option>
                        <option value="15+">15+ miles</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>3. Which setting do you generally prefer? (Select all that apply)</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-indoor" name="preferences" value="indoor">
                            <label for="pref-indoor">Indoor activities</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-outdoor" name="preferences" value="outdoor">
                            <label for="pref-outdoor">Outdoor activities</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-physical" name="preferences" value="physical">
                            <label for="pref-physical">Physical/active</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-relaxed" name="preferences" value="relaxed">
                            <label for="pref-relaxed">Relaxed/low-key</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-structured" name="preferences" value="structured">
                            <label for="pref-structured">Structured events</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pref-spontaneous" name="preferences" value="spontaneous">
                            <label for="pref-spontaneous">Spontaneous gatherings</label>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="prevPage(7)">Back</button>
                    <button type="submit" class="btn-primary">Submit</button>
                </div>
            </div>

            <!-- End of form -->
        </form>
    </div>
            <div class="survey-page" id="page6">

    <script>
        let currentPage = 1;
        const totalPages = 8;

        // Start survey from welcome page
        function startSurvey() {
            // Hide welcome page
            document.getElementById('pageWelcome').classList.remove('active');
            // Show page 1
            document.getElementById('page1').classList.add('active');
            // Show progress bar
            document.getElementById('progressContainer').style.display = 'block';
            // Update progress bar
            updateProgress();
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Login user with username
        async function loginUser() {
            const username = document.getElementById('loginUsername').value.trim();
            const loginButton = document.getElementById('loginButton');
            const loginError = document.getElementById('loginError');

            // Validate username
            if (!username) {
                showLoginError('Please enter your username');
                return;
            }

            if (username.length < 3) {
                showLoginError('Username must be at least 3 characters');
                return;
            }

            // Show loading state
            loginButton.disabled = true;
            loginButton.innerHTML = '<span style="display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px;"></span>Loading...';
            hideLoginError();

            try {
                const API_BASE_URL = 'http://localhost:3000';
                const response = await fetch(`${API_BASE_URL}/api/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username })
                });

                const result = await response.json();

                if (result.success && result.userId) {
                    // Store userId and username in localStorage
                    localStorage.setItem('empower_userId', result.userId);
                    localStorage.setItem('empower_username', result.username);
                    localStorage.setItem('empower_name', result.name);

                    // Redirect to recommendations page
                    window.location.href = `http://localhost:8081/profile/recommendations.html?userId=${result.userId}`;
                } else {
                    showLoginError(result.error || 'Username not found. Please check your username or take the survey.');
                    loginButton.disabled = false;
                    loginButton.textContent = 'Access My Recommendations';
                }
            } catch (error) {
                console.error('Login error:', error);
                showLoginError('Unable to connect to server. Please make sure the server is running.');
                loginButton.disabled = false;
                loginButton.textContent = 'Access My Recommendations';
            }
        }

        function showLoginError(message) {
            const loginError = document.getElementById('loginError');
            loginError.textContent = message;
            loginError.style.display = 'block';
        }

        function hideLoginError() {
            const loginError = document.getElementById('loginError');
            loginError.style.display = 'none';
        }

        // Allow Enter key to submit login
        document.addEventListener('DOMContentLoaded', function() {
            const loginInput = document.getElementById('loginUsername');
            if (loginInput) {
                loginInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        loginUser();
                    }
                });
            }
        });

        /**
         * INTEREST CATEGORIES CONFIGURATION
         * 
         * To add a new category:
         * 1. Add a new key to interestCategories object
         * 2. Include: label, icon (emoji), subInterests array
         * 
         * To add a new interest:
         * 1. Find the category key
         * 2. Add object with {id, label} to subInterests array
         * 
         * To remove: Delete the entry
         */
        const interestCategories = {
            sports: {
                label: "Sports & Fitness",
                icon: "ðŸƒ",
                subInterests: [
                    { id: "team-sports", label: "Team Sports Leagues (basketball, soccer, volleyball)" },
                    { id: "tennis", label: "Tennis & Racquet Sports (Leagues & Groups)" },
                    { id: "yoga", label: "Yoga & Pilates Classes" },
                    { id: "running", label: "Running Groups & Clubs" },
                    { id: "swimming", label: "Swimming & Water Sports (Groups & Teams)" },
                    { id: "martial-arts", label: "Martial Arts Classes & Dojos" },
                    { id: "dance-fitness", label: "Dance & Fitness Classes" },
                    { id: "gym", label: "Group Fitness Classes & Bootcamps" },
                    { id: "cycling", label: "Cycling Groups & Bike Clubs" },
                    { id: "boxing", label: "Boxing Classes & Sparring Groups" }
                ]
            },
            arts: {
                label: "Arts & Culture",
                icon: "ðŸŽ¨",
                subInterests: [
                    { id: "museums", label: "Museum Tours & Gallery Walks" },
                    { id: "theater", label: "Theater & Performances (Group Outings)" },
                    { id: "painting", label: "Painting & Drawing Classes" },
                    { id: "photography", label: "Photography Groups & Photo Walks" },
                    { id: "pottery", label: "Pottery & Ceramics Classes" },
                    { id: "crafts", label: "Crafts & DIY Workshops" },
                    { id: "writing", label: "Creative Writing Groups & Workshops" },
                    { id: "film", label: "Film Screenings & Cinema Groups" },
                    { id: "street-art", label: "Street Art Tours & Graffiti Walks" }
                ]
            },
            food: {
                label: "Food & Dining",
                icon: "ðŸ½ï¸",
                subInterests: [
                    { id: "cooking-classes", label: "Cooking Classes" },
                    { id: "wine-tasting", label: "Wine Tasting Events" },
                    { id: "food-tours", label: "Food Tours & Culinary Walks" },
                    { id: "food-events", label: "Food Festivals & Pop-ups" },
                    { id: "baking", label: "Baking & Pastry Classes" },
                    { id: "coffee", label: "Coffee Tastings & Cafe Meetups" },
                    { id: "breweries", label: "Brewery Tours & Beer Tasting Events" },
                    { id: "farmers-markets", label: "Farmers Market Visits & Food Walks" },
                    { id: "restaurant-weeks", label: "Restaurant Week Events & Group Dining" },
                    { id: "supper-clubs", label: "Supper Clubs & Dining Groups" }
                ]
            },
            social: {
                label: "Social & Entertainment",
                icon: "ðŸŽ‰",
                subInterests: [
                    { id: "social-mixers", label: "Social Mixers & Networking" },
                    { id: "bars-clubs", label: "Bars & Nightlife" },
                    { id: "trivia", label: "Trivia Nights" },
                    { id: "karaoke", label: "Karaoke" },
                    { id: "comedy", label: "Comedy Shows & Open Mics" },
                    { id: "networking", label: "Professional Networking Events" },
                    { id: "rooftop-events", label: "Rooftop Events & Gatherings" },
                    { id: "speed-dating", label: "Speed Dating & Singles Events" },
                    { id: "happy-hours", label: "Happy Hours & After-Work Socials" }
                ]
            },
            learning: {
                label: "Learning & Development",
                icon: "ðŸ“š",
                subInterests: [
                    { id: "skill-workshops", label: "Skill-Building Workshops" },
                    { id: "professional-development", label: "Professional Development Classes" },
                    { id: "lectures", label: "Lectures & Discussion Groups" },
                    { id: "book-clubs", label: "Book Clubs" },
                    { id: "language", label: "Language Exchange Groups" },
                    { id: "tech", label: "Technology & Coding Meetups" },
                    { id: "business", label: "Business & Entrepreneurship Groups" },
                    { id: "science", label: "Science & Innovation Events" },
                    { id: "financial-literacy", label: "Financial Literacy Workshops" }
                ]
            },
            outdoor: {
                label: "Outdoor & Urban Nature",
                icon: "ðŸŒ²",
                subInterests: [
                    { id: "urban-hiking", label: "Urban Hiking Groups & Walking Clubs" },
                    { id: "biking", label: "Biking Groups & Cycling Clubs" },
                    { id: "kayaking", label: "Kayaking Groups & Paddle Clubs" },
                    { id: "rock-climbing", label: "Rock Climbing Gyms & Climbing Groups" },
                    { id: "gardening", label: "Community Gardening Groups" },
                    { id: "park-activities", label: "Park Activities & Outdoor Fitness Groups" },
                    { id: "walking-tours", label: "Walking Tours & Urban Exploration Groups" }
                ]
            },
            games: {
                label: "Games & Hobbies",
                icon: "ðŸŽ®",
                subInterests: [
                    { id: "board-games", label: "Board Game Meetups & Game Nights" },
                    { id: "video-games", label: "Video Game Tournaments & Gaming Events" },
                    { id: "card-games", label: "Card Game Clubs (Poker, Bridge)" },
                    { id: "puzzles", label: "Puzzle Groups & Escape Rooms" },
                    { id: "chess", label: "Chess Clubs & Tournaments" },
                    { id: "arcade", label: "Arcade & Barcade Events" },
                    { id: "dnd-rpg", label: "D&D & RPG Groups" }
                ]
            },
            community: {
                label: "Volunteering & Community",
                icon: "ðŸ¤",
                subInterests: [
                    { id: "charity", label: "Charity Work & Fundraisers" },
                    { id: "environmental", label: "Environmental Cleanups & Groups" },
                    { id: "mentoring", label: "Mentoring & Tutoring Groups" },
                    { id: "animal-welfare", label: "Animal Welfare & Rescue Groups" },
                    { id: "community-organizing", label: "Community Organizing & Activism" },
                    { id: "neighborhood-events", label: "Neighborhood Events & Block Parties" },
                    { id: "urban-planning", label: "Urban Planning & Civic Engagement Groups" }
                ]
            },
            wellness: {
                label: "Wellness & Mindfulness",
                icon: "ðŸ§˜",
                subInterests: [
                    { id: "meditation", label: "Meditation Groups & Classes" },
                    { id: "mindfulness", label: "Mindfulness Workshops & Groups" },
                    { id: "spa", label: "Spa & Wellness Events (Group Sessions)" },
                    { id: "tai-chi", label: "Tai Chi & Qigong Classes" },
                    { id: "wellness-workshops", label: "Wellness Workshops" },
                    { id: "therapy-groups", label: "Support & Therapy Groups" },
                    { id: "sound-healing", label: "Sound Healing & Sound Bath Groups" }
                ]
            },
            music: {
                label: "Music & Performance",
                icon: "ðŸŽµ",
                subInterests: [
                    { id: "concerts-music", label: "Concerts & Live Music" },
                    { id: "playing-instrument", label: "Music Jams & Instrument Groups" },
                    { id: "singing", label: "Singing & Choir Groups" },
                    { id: "djing", label: "DJing & Music Production Workshops" },
                    { id: "music-festivals", label: "Music Festivals & Street Fests" },
                    { id: "open-mic", label: "Open Mic Nights" },
                    { id: "jazz-clubs", label: "Jazz Clubs & Live Jazz" }
                ]
            }
        };

        // Slider value update functions
        function updateSliderValue(sliderId, value) {
            document.getElementById(sliderId + '-value').textContent = value;
        }

        function updateLonelinessLabel(value) {
            const labels = {
                '1': 'Never',
                '2': 'Rarely',
                '3': 'Sometimes',
                '4': 'Often',
                '5': 'Very Often'
            };
            document.getElementById('loneliness-value').textContent = labels[value];
        }

        // Interest generation functions
        function generateBroadCategories() {
            const container = document.getElementById('broad-categories');
            let html = '';
            
            for (const [key, category] of Object.entries(interestCategories)) {
                html += `
                    <div class="checkbox-item">
                        <input type="checkbox" id="cat-${key}" name="categories" value="${key}">
                        <label for="cat-${key}">${category.icon} ${category.label}</label>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function generateSpecificInterests() {
            const selectedCategories = Array.from(document.querySelectorAll('input[name="categories"]:checked'))
                .map(checkbox => checkbox.value);
            
            const container = document.getElementById('specific-interests-container');
            
            if (selectedCategories.length === 0) {
                container.innerHTML = `
                    <div class="personality-intro">
                        <p>â¬…ï¸ Please go back and select at least one interest category</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            selectedCategories.forEach(catKey => {
                const category = interestCategories[catKey];
                html += `
                    <div class="interest-category">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3 style="color: #FF8C42; margin: 0;">${category.icon} ${category.label}</h3>
                            <div style="display: flex; gap: 8px;">
                                <button type="button" class="btn-select-toggle" onclick="toggleCategoryInterests('${catKey}', true)" style="font-size: 12px; padding: 6px 12px; background: #f5f5f5; border: none; border-radius: 6px; cursor: pointer;">Select All</button>
                                <button type="button" class="btn-select-toggle" onclick="toggleCategoryInterests('${catKey}', false)" style="font-size: 12px; padding: 6px 12px; background: #f5f5f5; border: none; border-radius: 6px; cursor: pointer;">Deselect All</button>
                            </div>
                        </div>
                        <div class="checkbox-group" data-category="${catKey}">
                `;
                
                category.subInterests.forEach(interest => {
                    html += `
                        <div class="checkbox-item">
                            <input type="checkbox" id="int-${interest.id}" name="interests" value="${interest.id}" data-category="${catKey}" checked>
                            <label for="int-${interest.id}">${interest.label}</label>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                    <div style="height: 24px;"></div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Toggle all interests in a category
        function toggleCategoryInterests(categoryKey, checked) {
            const checkboxes = document.querySelectorAll(`input[name="interests"][data-category="${categoryKey}"]`);
            checkboxes.forEach(checkbox => {
                checkbox.checked = checked;
            });
        }

        // Page navigation functions
        function nextPage(pageNum) {
            console.log('nextPage called with:', pageNum);
            console.log('Current page before:', currentPage);
            
            // Special handling: Generate specific interests when leaving page 5
            if (pageNum === 5) {
                generateSpecificInterests();
            }
            
            // Hide current page
            const currentPageEl = document.getElementById('page' + pageNum);
            console.log('Current page element:', currentPageEl);
            if (currentPageEl) {
                currentPageEl.classList.remove('active');
            }
            
            // Show next page
            currentPage = pageNum + 1;
            const nextPageEl = document.getElementById('page' + currentPage);
            console.log('Next page element:', nextPageEl);
            if (nextPageEl) {
                nextPageEl.classList.add('active');
            }
            
            // Update progress bar
            updateProgress();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            console.log('Current page after:', currentPage);
        }

        function prevPage(pageNum) {
            // Hide current page
            document.getElementById('page' + pageNum).classList.remove('active');
            
            // Show previous page
            currentPage = pageNum - 1;
            document.getElementById('page' + currentPage).classList.add('active');
            
            // Update progress bar
            updateProgress();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateProgress() {
            const progressPercent = (currentPage / totalPages) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = `Page ${currentPage} of ${totalPages}`;
        }

        function clearForm() {
            if (confirm('Are you sure you want to clear all form data?')) {
                document.getElementById('intakeForm').reset();
                currentPage = 1;
                document.querySelectorAll('.survey-page').forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById('page1').classList.add('active');
                updateProgress();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Show loading spinner
        function showLoadingSpinner() {
            const spinnerHTML = `
                <div id="loadingOverlay" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.95);
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    backdrop-filter: blur(4px);
                ">
                    <div style="
                        width: 60px;
                        height: 60px;
                        border: 6px solid #FFE8D6;
                        border-top: 6px solid #FF8C42;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                        margin-bottom: 20px;
                    "></div>
                    <h3 style="
                        font-family: 'Montserrat', sans-serif;
                        font-size: 24px;
                        color: #2C2C2C;
                        margin-bottom: 8px;
                    ">Generating Your Recommendations</h3>
                    <p style="
                        color: #666;
                        font-size: 16px;
                        text-align: center;
                        max-width: 400px;
                    ">This usually takes 30-60 seconds. We're analyzing your personality and finding the perfect activities for you!</p>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            document.body.insertAdjacentHTML('beforeend', spinnerHTML);
        }

        // Hide loading spinner
        function hideLoadingSpinner() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Form submission handler
        document.getElementById('intakeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get submit button and disable it
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            
            // Show loading spinner
            showLoadingSpinner();
            
            try {
            // Collect checkbox values
            const preferences = Array.from(document.querySelectorAll('input[name="preferences"]:checked'))
                .map(checkbox => checkbox.value);

            // Collect interest categories and specific interests
            const selectedCategories = Array.from(document.querySelectorAll('input[name="categories"]:checked'))
                .map(checkbox => checkbox.value);
            const selectedInterests = Array.from(document.querySelectorAll('input[name="interests"]:checked'))
                .map(checkbox => checkbox.value);

            // Collect affinity data
            const affinityData = collectAffinityData();

                // Get personality raw scores (1-7 scale)
                const q1 = parseInt(document.getElementById('q1')?.value) || 1;
                const q3 = parseInt(document.getElementById('q3')?.value) || 1;
                const q5 = parseInt(document.getElementById('q5')?.value) || 1;
                const q6 = parseInt(document.getElementById('q6')?.value) || 1;
                const q8 = parseInt(document.getElementById('q8')?.value) || 1;
                const q10 = parseInt(document.getElementById('q10')?.value) || 1;

                // Get motivation raw scores (1-5 scale)
                const m1 = parseInt(document.getElementById('m1')?.value) || 1;
                const m2 = parseInt(document.getElementById('m2')?.value) || 1;
                const m3 = parseInt(document.getElementById('m3')?.value) || 1;
                const m4 = parseInt(document.getElementById('m4')?.value) || 1;
                const m5 = parseInt(document.getElementById('m5')?.value) || 1;
                const m6 = parseInt(document.getElementById('m6')?.value) || 1;

                // Get social data
                const closeFriends = document.getElementById('closeFriends').value;
                const lonelinessValue = parseInt(document.getElementById('loneliness')?.value) || 3;
                const lonelinessLabels = {
                    '1': 'Never (1)',
                    '2': 'Rarely (2)',
                    '3': 'Sometimes (3)',
                    '4': 'Often (4)',
                    '5': 'Very Often (5)'
                };
                const loneliness = lonelinessLabels[lonelinessValue.toString()] || 'Sometimes (3)';
                
                const socialSatisfactionValue = parseInt(document.getElementById('socialSatisfaction')?.value) || 4;
                const socialSatisfaction = `Neutral (${socialSatisfactionValue})`;

                // Map free time values to match backend expectations
                const freeTimeMap = {
                    '<5': 'Less than 5 hours',
                    '5-10': '5-10 hours',
                    '10-20': '10-20 hours',
                    '>20': 'More than 20 hours'
                };
                const freeTime = freeTimeMap[document.getElementById('freeTime').value] || document.getElementById('freeTime').value;

                // Map travel distance values
                const travelDistanceMap = {
                    '<1': 'Less than 1 mile',
                    '1-5': '1-5 miles',
                    '5-15': '5-15 miles',
                    '15+': '15+ miles'
                };
                const travelDistance = travelDistanceMap[document.getElementById('travelDistance').value] || document.getElementById('travelDistance').value;

                // Check if we're in edit mode
                const urlParams = new URLSearchParams(window.location.search);
                const isEditMode = urlParams.get('edit') === 'true';
                const userId = urlParams.get('userId');
                
                // Format data for backend API
                const surveyData = {
                    name: document.getElementById('firstName').value.trim(),
                    username: document.getElementById('username').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    age: parseInt(document.getElementById('age').value),
                    gender: document.getElementById('gender').value,
                    zipcode: document.getElementById('zipcode').value.trim(),
                    
                    // Add userId and isEdit flag for edit mode
                    userId: isEditMode ? userId : undefined,
                    isEdit: isEditMode,
                    
                    personality: {
                        q1: q1,
                        q6: q6,
                        q3: q3,
                        q8: q8,
                        q5: q5,
                        q10: q10
                    },
                    
                    motivation: {
                        m1: m1,
                        m2: m2,
                        m3: m3,
                        m4: m4,
                        m5: m5,
                        m6: m6
                    },
                    
                    social: {
                        closeFriends: closeFriends,
                        satisfaction: socialSatisfaction,
                        loneliness: loneliness,
                        lookingFor: [] // TODO: Add "looking for" field to form if needed
                    },
                    
                    interests: {
                        categories: selectedCategories,
                        specific: selectedInterests.join(', ')
                    },
                    
                    preferences: {
                        freeTime: freeTime,
                        travelDistance: travelDistance,
                        indoor: preferences.includes('indoor'),
                        outdoor: preferences.includes('outdoor'),
                        physical: preferences.includes('physical'),
                        relaxed: preferences.includes('relaxed'),
                        structured: preferences.includes('structured'),
                        spontaneous: preferences.includes('spontaneous')
                    },
                    
                    affinityGroups: {
                        faith: affinityData.faithBased?.selected ? affinityData.faithBased.specific : [],
                        lgbtq: affinityData.lgbtq?.selected ? affinityData.lgbtq.specific : [],
                        cultural: affinityData.cultural?.selected ? affinityData.cultural.specific : [],
                        womens: affinityData.womens?.selected ? affinityData.womens.specific : [],
                        youngProf: affinityData.youngProfessionals?.selected ? affinityData.youngProfessionals.specific : [],
                        international: affinityData.international?.selected ? affinityData.international.specific : []
                    }
                };
                
                console.log('Submitting survey data:', surveyData);
                
                // Submit to backend API
                const API_BASE_URL = 'http://localhost:3000';
                
                const response = await fetch(`${API_BASE_URL}/api/submit-survey`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(surveyData)
                });
                
                // Check if response is ok
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: `HTTP ${response.status}: ${response.statusText}` }));
                    throw new Error(errorData.error || `Server error: ${response.status} ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    // Store userId in localStorage for future visits
                    localStorage.setItem('empower_userId', result.userId);
                    
                    // Hide loading spinner
                    hideLoadingSpinner();

                    // Redirect to match page (single-match feedback system)
                    window.location.href = 'http://localhost:8081/profile/recommendations.html?userId=' + result.userId;
                } else {
                    throw new Error(result.error || 'Failed to submit survey');
                }
                
            } catch (error) {
                console.error('Error submitting survey:', error);
                
                // Hide loading spinner
                hideLoadingSpinner();
                
                // Show user-friendly error message
                let errorMessage = 'We encountered an error processing your survey. ';
                
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage += 'Please check your internet connection and make sure the server is running.';
                } else if (error.message.includes('400')) {
                    errorMessage += 'Please check that all required fields are filled out correctly.';
                } else if (error.message.includes('500')) {
                    errorMessage += 'Our servers are experiencing issues. Please try again in a few moments.';
                } else {
                    errorMessage += error.message || 'Please try again or contact support if the problem persists.';
                }
                
                alert(errorMessage);
                
                // Re-enable submit button
                submitButton.disabled = false;
                submitButton.textContent = originalButtonText;
            }
        });

        // Recommendations parsing and display functions have been moved to /assets/js/recommendations.js
        // Survey now redirects to /profile/recommendations.html after submission

        // Zip code validation
        document.getElementById('zipcode').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 5);
        });

        // Initialize broad categories on page load
        window.addEventListener('DOMContentLoaded', function() {
            generateBroadCategories();
            setupAffinityToggle();
            
            // Check for edit mode on page load
            const urlParams = new URLSearchParams(window.location.search);
            const isEditMode = urlParams.get('edit') === 'true';
            const userId = urlParams.get('userId');
            
            if (isEditMode && userId) {
                loadExistingSurveyData(userId);
            }
        });
        
        // Function to load existing survey data
        async function loadExistingSurveyData(userId) {
            try {
                showLoadingSpinner();
                const API_BASE_URL = 'http://localhost:3000';
                const response = await fetch(`${API_BASE_URL}/api/survey/${userId}`);
                
                if (!response.ok) {
                    // Handle HTTP errors - try to get error message
                    let errorMessage = `HTTP ${response.status}`;
                    try {
                        const errorResult = await response.json();
                        errorMessage = errorResult.error || errorMessage;
                    } catch (e) {
                        // If JSON parsing fails, use status text
                        errorMessage = response.statusText || errorMessage;
                    }
                    console.error('API Error:', response.status, errorMessage);
                    hideLoadingSpinner();
                    alert(`Error loading survey data (${response.status}): ${errorMessage}`);
                    return;
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    const data = result.data;
                    
                    // Pre-fill basic info
                    document.getElementById('firstName').value = data.name || '';
                    document.getElementById('username').value = data.username || '';
                    document.getElementById('email').value = data.email || '';
                    document.getElementById('age').value = data.age || '';
                    document.getElementById('gender').value = data.gender || '';
                    document.getElementById('zipcode').value = data.zipcode || '';
                    
                    // Pre-fill personality scores
                    if (data.personality) {
                        document.getElementById('q1').value = data.personality.q1 || 4;
                        document.getElementById('q6').value = data.personality.q6 || 4;
                        document.getElementById('q3').value = data.personality.q3 || 4;
                        document.getElementById('q8').value = data.personality.q8 || 4;
                        document.getElementById('q5').value = data.personality.q5 || 4;
                        document.getElementById('q10').value = data.personality.q10 || 4;
                    }
                    
                    // Pre-fill motivation scores
                    if (data.motivation) {
                        document.getElementById('m1').value = data.motivation.m1 || 3;
                        document.getElementById('m2').value = data.motivation.m2 || 3;
                        document.getElementById('m3').value = data.motivation.m3 || 3;
                        document.getElementById('m4').value = data.motivation.m4 || 3;
                        document.getElementById('m5').value = data.motivation.m5 || 3;
                        document.getElementById('m6').value = data.motivation.m6 || 3;
                    }
                    
                    // Pre-fill social data
                    if (data.social) {
                        document.getElementById('closeFriends').value = data.social.closeFriends || '';
                        
                        // Parse loneliness (format: "Sometimes (3)")
                        if (data.social.loneliness) {
                            const lonelinessMatch = data.social.loneliness.match(/\((\d+)\)/);
                            if (lonelinessMatch) {
                                document.getElementById('loneliness').value = lonelinessMatch[1];
                            }
                        }
                        
                        // Parse satisfaction (format: "Neutral (4)")
                        if (data.social.satisfaction) {
                            const satisfactionMatch = data.social.satisfaction.match(/\((\d+)\)/);
                            if (satisfactionMatch) {
                                document.getElementById('socialSatisfaction').value = satisfactionMatch[1];
                            }
                        }
                    }
                    
                    // Pre-fill interests - need to wait for categories to be generated
                    setTimeout(() => {
                        if (data.interests) {
                            // Pre-select categories
                            if (data.interests.categories && Array.isArray(data.interests.categories)) {
                                data.interests.categories.forEach(category => {
                                    // Map Airtable labels back to frontend keys
                                    const categoryMap = {
                                        'Sports & Fitness': 'sports',
                                        'Arts & Culture': 'arts',
                                        'Food & Dining': 'food',
                                        'Social & Networking': 'social',
                                        'Learning & Education': 'learning',
                                        'Outdoor & Nature': 'outdoor',
                                        'Technology & Gaming': 'games',
                                        'Community & Volunteering': 'community',
                                        'Health & Wellness': 'wellness',
                                        'Music & Entertainment': 'music'
                                    };
                                    const frontendKey = categoryMap[category] || category.toLowerCase().replace(/\s+/g, '-');
                                    const checkbox = document.querySelector(`input[name="categories"][value="${frontendKey}"]`);
                                    if (checkbox) checkbox.checked = true;
                                });
                                
                                // Trigger category selection to generate specific interests
                                const firstCategory = data.interests.categories[0];
                                const firstKey = Object.keys(categoryMap).find(k => categoryMap[k] === firstCategory) || firstCategory;
                                if (firstKey) {
                                    generateSpecificInterests();
                                }
                            }
                            
                            // Pre-select specific interests (parse comma-separated string)
                            setTimeout(() => {
                                if (data.interests.specific) {
                                    const interestsList = data.interests.specific.split(',').map(i => i.trim());
                                    interestsList.forEach(interest => {
                                        const checkbox = document.querySelector(`input[name="interests"][value="${interest}"]`);
                                        if (checkbox) checkbox.checked = true;
                                    });
                                }
                            }, 500);
                        }
                    }, 100);
                    
                    // Pre-fill preferences
                    if (data.preferences) {
                        document.getElementById('freeTime').value = data.preferences.freeTime || '';
                        document.getElementById('travelDistance').value = data.preferences.travelDistance || '';
                        
                        // Pre-select preference checkboxes
                        if (data.preferences.indoor) {
                            const checkbox = document.querySelector('input[name="preferences"][value="indoor"]');
                            if (checkbox) checkbox.checked = true;
                        }
                        if (data.preferences.outdoor) {
                            const checkbox = document.querySelector('input[name="preferences"][value="outdoor"]');
                            if (checkbox) checkbox.checked = true;
                        }
                        if (data.preferences.physical) {
                            const checkbox = document.querySelector('input[name="preferences"][value="physical"]');
                            if (checkbox) checkbox.checked = true;
                        }
                        if (data.preferences.relaxed) {
                            const checkbox = document.querySelector('input[name="preferences"][value="relaxed"]');
                            if (checkbox) checkbox.checked = true;
                        }
                        if (data.preferences.structured) {
                            const checkbox = document.querySelector('input[name="preferences"][value="structured"]');
                            if (checkbox) checkbox.checked = true;
                        }
                        if (data.preferences.spontaneous) {
                            const checkbox = document.querySelector('input[name="preferences"][value="spontaneous"]');
                            if (checkbox) checkbox.checked = true;
                        }
                    }
                    
                    // Pre-fill affinity groups (simplified - you may need to adjust based on your form structure)
                    if (data.affinityGroups) {
                        // LGBTQ
                        if (data.affinityGroups.lgbtq && data.affinityGroups.lgbtq.length > 0) {
                            const lgbtqCheckbox = document.querySelector('input[name="affinity-lgbtq"]');
                            if (lgbtqCheckbox) lgbtqCheckbox.checked = true;
                            
                            // Show options and pre-select
                            const lgbtqSection = document.querySelector('.affinity-section[data-category="lgbtq"]');
                            if (lgbtqSection) {
                                const optionsDiv = lgbtqSection.querySelector('.affinity-options');
                                if (optionsDiv) optionsDiv.style.display = 'block';
                                
                                data.affinityGroups.lgbtq.forEach(option => {
                                    // Map Airtable values back to frontend keys
                                    const optionMap = {
                                        "Gay men's communities": "gay-men",
                                        "Lesbian communities": "lesbian",
                                        "Bisexual/Pansexual communities": "bisexual",
                                        "Transgender communities": "transgender",
                                        "Queer/Non-binary communities": "queer-nonbinary",
                                        "General LGBTQ+ inclusive spaces": "general-lgbtq"
                                    };
                                    const frontendKey = optionMap[option] || option.toLowerCase().replace(/\s+/g, '-');
                                    const checkbox = document.querySelector(`input[name="affinity-lgbtq-options"][value="${frontendKey}"]`);
                                    if (checkbox) checkbox.checked = true;
                                });
                            }
                        }
                        
                        // Repeat for other affinity groups as needed...
                        // (You can expand this pattern for faith, cultural, womens, youngProf, international)
                    }
                    
                    // Auto-start survey (skip welcome page)
                    startSurvey();
                    
                    hideLoadingSpinner();
                } else {
                    hideLoadingSpinner();
                    console.error('API Response:', result);
                    alert(`Could not load survey data: ${result.error || 'Unknown error'}. Please check the console for details.`);
                }
            } catch (error) {
                console.error('Error loading survey data:', error);
                hideLoadingSpinner();
                alert('Error loading survey data: ' + error.message + '. Check browser console for details.');
            }
        }

        // Affinity expand/collapse functionality
        function setupAffinityToggle() {
            const affinityMainCheckboxes = document.querySelectorAll('.affinity-main');
            
            affinityMainCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const category = this.dataset.category;
                    const optionsDiv = document.getElementById(category + '-options');
                    
                    if (this.checked) {
                        // Expand with smooth animation
                        optionsDiv.style.display = 'block';
                        optionsDiv.style.maxHeight = '0px';
                        optionsDiv.style.opacity = '0';
                        optionsDiv.style.transition = 'all 0.3s ease';
                        
                        setTimeout(() => {
                            optionsDiv.style.maxHeight = '1000px';
                            optionsDiv.style.opacity = '1';
                        }, 10);
                    } else {
                        // Collapse and uncheck all specific options
                        optionsDiv.style.maxHeight = '0px';
                        optionsDiv.style.opacity = '0';
                        
                        setTimeout(() => {
                            optionsDiv.style.display = 'none';
                            // Uncheck all specific options in this category
                            const specificCheckboxes = optionsDiv.querySelectorAll('input[type="checkbox"]');
                            specificCheckboxes.forEach(cb => cb.checked = false);
                        }, 300);
                    }
                });
            });
        }

        // Helper function to format affinity data for GPT prompt
        function generateAffinityPromptSection(affinityGroups) {
            const selected = [];
            
            if (affinityGroups.faithBased.selected && affinityGroups.faithBased.specific.length > 0) {
                selected.push(`- Faith: ${affinityGroups.faithBased.specific.join(', ')}`);
            }
            if (affinityGroups.lgbtq.selected && affinityGroups.lgbtq.specific.length > 0) {
                selected.push(`- LGBTQ+: ${affinityGroups.lgbtq.specific.join(', ')}`);
            }
            if (affinityGroups.cultural.selected && affinityGroups.cultural.specific.length > 0) {
                selected.push(`- Cultural: ${affinityGroups.cultural.specific.join(', ')}`);
            }
            if (affinityGroups.womens.selected && affinityGroups.womens.specific.length > 0) {
                selected.push(`- Women's groups: ${affinityGroups.womens.specific.join(', ')}`);
            }
            if (affinityGroups.youngProfessionals.selected && affinityGroups.youngProfessionals.specific.length > 0) {
                selected.push(`- Young professionals: ${affinityGroups.youngProfessionals.specific.join(', ')}`);
            }
            if (affinityGroups.international.selected && affinityGroups.international.specific.length > 0) {
                selected.push(`- International: ${affinityGroups.international.specific.join(', ')}`);
            }
            
            if (selected.length === 0) {
                return "None specified";
            }
            
            return selected.join('\n');
        }

        // Helper function to generate affinity balance instructions
        function generateAffinityBalanceInstructions(affinityGroups) {
            // Check if any affinity groups are selected
            const hasAffinities = affinityGroups.faithBased.selected || 
                                 affinityGroups.lgbtq.selected || 
                                 affinityGroups.cultural.selected || 
                                 affinityGroups.womens.selected || 
                                 affinityGroups.youngProfessionals.selected || 
                                 affinityGroups.international.selected;
            
            if (!hasAffinities) {
                return "No affinity preferences specified - focus entirely on interests and personality match.";
            }
            
            return `- PRIMARY FOCUS (70%): Match user's interests, personality, and social needs first
- AFFINITY ENHANCEMENT (30%): Include 3 out of 10 recommendations that ALSO align with their affinity communities
- **CRITICAL:** Affinity recommendations MUST still match their core interests
  * Example: If they like hiking AND selected "gay-men", recommend "Gay Men's Hiking Group" âœ“
  * Example: If they don't have trivia in interests, DON'T recommend "Gay Trivia Night" âœ—
- Affinity is a BOOST to good matches, not a filter or replacement
- Never exclude general community events - they should discover both affinity AND general communities
- Balance must still apply: 5 recurring + 5 one-time across all 10 recommendations`;
        }

        // Function to collect affinity data
        function collectAffinityData() {
            const affinityData = {
                faithBased: {
                    selected: document.getElementById('affinity-faith')?.checked || false,
                    specific: []
                },
                lgbtq: {
                    selected: document.getElementById('affinity-lgbtq')?.checked || false,
                    specific: []
                },
                cultural: {
                    selected: document.getElementById('affinity-cultural')?.checked || false,
                    specific: []
                },
                womens: {
                    selected: document.getElementById('affinity-womens')?.checked || false,
                    specific: []
                },
                youngProfessionals: {
                    selected: document.getElementById('affinity-young-prof')?.checked || false,
                    specific: []
                },
                international: {
                    selected: document.getElementById('affinity-international')?.checked || false,
                    specific: []
                }
            };

            // Collect specific selections for each category
            if (affinityData.faithBased.selected) {
                affinityData.faithBased.specific = Array.from(document.querySelectorAll('input[name="affinity-faith-specific"]:checked'))
                    .map(cb => cb.value);
            }
            if (affinityData.lgbtq.selected) {
                affinityData.lgbtq.specific = Array.from(document.querySelectorAll('input[name="affinity-lgbtq-specific"]:checked'))
                    .map(cb => cb.value);
            }
            if (affinityData.cultural.selected) {
                affinityData.cultural.specific = Array.from(document.querySelectorAll('input[name="affinity-cultural-specific"]:checked'))
                    .map(cb => cb.value);
            }
            if (affinityData.womens.selected) {
                affinityData.womens.specific = Array.from(document.querySelectorAll('input[name="affinity-womens-specific"]:checked'))
                    .map(cb => cb.value);
            }
            if (affinityData.youngProfessionals.selected) {
                affinityData.youngProfessionals.specific = Array.from(document.querySelectorAll('input[name="affinity-young-prof-specific"]:checked'))
                    .map(cb => cb.value);
            }
            if (affinityData.international.selected) {
                affinityData.international.specific = Array.from(document.querySelectorAll('input[name="affinity-international-specific"]:checked'))
                    .map(cb => cb.value);
            }

            return affinityData;
        }

        // STEP 1: Dynamic GPT Prompt Generation
        // This function takes the user's survey data and creates a personalized prompt for the GPT
        function generatePersonalizedGPTPrompt(userProfile) {
            // Calculate today's date and 30 days from now
            const today = new Date();
            const futureDate = new Date();
            futureDate.setDate(today.getDate() + 30);
            
            // Format dates in readable format (e.g., "Nov 12, 2025")
            const todayStr = today.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
            const futureStr = futureDate.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
            
            // INTERPRET PERSONALITY SCORES
            // Extraversion: Low (2-6) = Introverted, Medium (7-10) = Ambivert, High (11-14) = Extraverted
            const isIntroverted = userProfile.extraversion < 7;
            const isExtraverted = userProfile.extraversion > 10;
            
            // Conscientiousness: Low = Spontaneous, High = Organized
            const isHighlyConscientious = userProfile.conscientiousness > 10;
            const isSpontaneous = userProfile.conscientiousness < 7;
            
            // Openness: High = Loves new experiences
            const isOpenToNew = userProfile.openness > 10;
            
            // INTERPRET SOCIAL NEEDS
            // Calculate composite social need score (higher = more need for connection)
            const socialNeedScore = (userProfile.loneliness * 2) + 
                                   (15 - userProfile.closeFriends) + 
                                   ((8 - userProfile.socialSatisfaction) * 1.5);
            const hasHighSocialNeed = socialNeedScore > 30;
            const isSociallyIsolated = userProfile.closeFriends < 3;
            const isLonely = userProfile.loneliness >= 4;
            
            // DETERMINE DOMINANT MOTIVATION
            // Find which motivation type is strongest
            const motivations = {
                intrinsic: userProfile.intrinsicMotivation,
                social: userProfile.socialMotivation,
                achievement: userProfile.achievementMotivation
            };
            const dominantMotivation = Object.keys(motivations).reduce((a, b) => 
                motivations[a] > motivations[b] ? a : b
            );
            
            // MAP TRAVEL DISTANCE TO ACTUAL MILES
            const distanceMap = {
                '<1': '1 mile',
                '1-5': '5 miles',
                '5-15': '15 miles',
                '15+': '25 miles'
            };
            const maxDistance = distanceMap[userProfile.travelDistance] || '10 miles';
            
            // BUILD PERSONALIZED PRIORITIES
            // This array determines what the GPT should prioritize for THIS specific user
            let priorities = [];
            
            // Priority 1: If user is lonely/isolated, CONNECTION is the top priority
            if (hasHighSocialNeed) {
                priorities.push("**CRITICAL: Community building and making friends** - User is lonely and needs connection");
                priorities.push("Recurring weekly meetups that build consistent relationships");
                priorities.push("Explicitly welcoming and newcomer-friendly environments");
                priorities.push("Small-medium groups with structured social interaction");
            }
            
            // Priority 2: Group size based on extraversion
            if (isIntroverted) {
                priorities.push("Small intimate groups (max 8-10 people) - user is introverted");
            } else if (isExtraverted) {
                priorities.push("Large social events (20+ people) - user is extraverted and energized by crowds");
            }
            
            // Priority 3: Structure based on conscientiousness
            if (isHighlyConscientious) {
                priorities.push("Structured programs with clear schedules and goals - user is highly organized");
            } else if (isSpontaneous) {
                priorities.push("Flexible drop-in activities without strict commitments - user is spontaneous");
            }
            
            // Priority 4: Novelty based on openness
            if (isOpenToNew) {
                priorities.push("Novel and diverse experiences - user loves trying new things");
            }
            
            // Priority 5: Motivation-based messaging
            if (dominantMotivation === 'achievement') {
                priorities.push("Skill-building and goal-oriented activities - user is achievement-motivated");
            } else if (dominantMotivation === 'social') {
                priorities.push("Strong social connection opportunities - user is socially motivated");
            } else if (dominantMotivation === 'intrinsic') {
                priorities.push("Fun and enjoyable activities - user seeks pure enjoyment");
            }
            
            // Priority 6: Activity preferences
            if (userProfile.activityPreferences.includes('physical')) {
                priorities.push("Active and physically engaging events");
            }
            if (userProfile.activityPreferences.includes('outdoor')) {
                priorities.push("Outdoor activities in nature");
            }
            if (userProfile.activityPreferences.includes('relaxed')) {
                priorities.push("Low-key and relaxed atmospheres");
            }
            
            // BUILD THE COMPLETE GPT PROMPT
            // This is what gets sent to the Custom GPT
            const prompt = `
USER PROFILE:

Demographics:
- Name: ${userProfile.firstName}
- Age: ${userProfile.age}
- Location: ${userProfile.zipcode}
- Available time: ${userProfile.freeTime} per week
- Max travel: ${maxDistance}

Personality (out of 14):
- Extraversion: ${userProfile.extraversion}/14 (${isIntroverted ? 'INTROVERTED' : isExtraverted ? 'EXTRAVERTED' : 'AMBIVERT'})
- Conscientiousness: ${userProfile.conscientiousness}/14 (${isHighlyConscientious ? 'HIGHLY ORGANIZED' : isSpontaneous ? 'SPONTANEOUS' : 'BALANCED'})
- Openness: ${userProfile.openness}/14 (${isOpenToNew ? 'VERY OPEN TO NEW EXPERIENCES' : 'MODERATELY OPEN'})

Social Situation:
- Close friends: ${userProfile.closeFriends} ${isSociallyIsolated ? '(SOCIALLY ISOLATED)' : ''}
- Loneliness: ${userProfile.loneliness}/5 ${isLonely ? '(OFTEN LONELY - HIGH PRIORITY)' : ''}
- Social satisfaction: ${userProfile.socialSatisfaction}/7
- **SOCIAL NEED SCORE: ${Math.round(socialNeedScore)}/50** ${hasHighSocialNeed ? '(HIGH - Emphasize community building!)' : '(LOW - Focus on activities)'}

Core Motivations (out of 10):
- Intrinsic (fun): ${userProfile.intrinsicMotivation}/10
- Social (connection): ${userProfile.socialMotivation}/10
- Achievement (skills): ${userProfile.achievementMotivation}/10
- **DOMINANT: ${dominantMotivation.toUpperCase()}**

Interests:
- Categories: ${userProfile.interestCategories.join(', ')}
- Specific: ${userProfile.specificInterests.join(', ')}

Activity Preferences: ${userProfile.activityPreferences.join(', ')}

Affinity Communities:
${generateAffinityPromptSection(userProfile.affinityGroups)}

---

SEARCH CONSTRAINTS:
- **Timeframe: ${todayStr} to ${futureStr} (next 30 days from TODAY)**
- **Today's date: ${todayStr}** (use this to filter events)
- Location: Within ${maxDistance} of zipcode ${userProfile.zipcode}
- Required balance: 
  * 50% RECURRING events (weekly groups, leagues, ongoing clubs)
  * 50% ONE-TIME events (workshops, concerts, single activities)

RECOMMENDATION PRIORITIES (in order):
${priorities.map((p, i) => `${i + 1}. ${p}`).join('\n')}

AFFINITY BALANCE RULE:
${generateAffinityBalanceInstructions(userProfile.affinityGroups)}

EVENT SOURCES TO SEARCH:
âœ“ Meetup groups (especially recurring)
âœ“ Local sports leagues (ZogSports, YMCA, rec leagues)
âœ“ Eventbrite events
âœ“ Fitness studio class schedules
âœ“ Community centers and parks & rec
âœ“ Volunteer organizations
âœ“ Book clubs, hobby groups, maker spaces
âœ“ Cultural organizations (museums, galleries, theaters)

REQUIRED OUTPUT FORMAT:
For each recommendation provide:
1. Event/Organization name
2. Type: [RECURRING] or [ONE-TIME]
3. Date/Schedule: (specific date OR recurring schedule)
4. Location & distance from ${userProfile.zipcode}
5. Group size: Small/Medium/Large
6. Match score: 0-100
7. Why it's a match (2-3 reasons based on THIS specific profile)
8. Registration link (if available, otherwise provide organization website)
9. Newcomer-friendly: Yes/No
10. Cost: Free/$/$$/$$$
11. Image URL: (find an appropriate image URL from the event/organization website if available)

BALANCE REQUIREMENT:
- Exactly 5 RECURRING opportunities
- Exactly 5 ONE-TIME events
- Minimum 2 different activity categories
- All events must be within the date range (${todayStr} - ${futureStr})

Please recommend 10 events/organizations in the ${userProfile.zipcode} area that match this profile.
`;
            
            return {
                prompt: prompt,
                metadata: {
                    generatedAt: today.toISOString(),
                    dateRange: { start: todayStr, end: futureStr },
                    socialNeedScore: Math.round(socialNeedScore),
                    dominantMotivation: dominantMotivation,
                    personalityProfile: {
                        extraversion: isIntroverted ? 'introverted' : isExtraverted ? 'extraverted' : 'ambivert',
                        conscientiousness: isHighlyConscientious ? 'organized' : isSpontaneous ? 'spontaneous' : 'balanced',
                        openness: isOpenToNew ? 'very open' : 'moderately open'
                    }
                }
            };
        }
    </script>
</body>
</html>
